(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{vM:()=>st,ti:()=>dt});var e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},o=document.querySelector(".popup_edit-profile"),r=document.querySelector(".popup_new-post"),n=document.querySelector(".popup_update-avatar"),i=document.querySelector(".popup_post"),a=document.querySelector(".popup_delete-submit"),u=document.querySelector(".popup_error"),c=document.forms["edit-profile"],l=document.forms["new-post"],s=document.forms["update-avatar"],d=document.forms["delete-submit"],p=document.forms["error-view"],m=i.querySelector(".view-post__image"),f=i.querySelector(".view-post__caption"),v=c["submit-button"],b=l["submit-button"],y=s["submit-button"],h=d["submit-button"],S=document.querySelectorAll(".popup__close-button"),_=l.title,E=l.link,C=c.name,P=c.vocation,k=s.elements["input-avatar-link"],g=document.querySelector(".photo-grid"),I=document.querySelector("#template-photo-post").content,L=document.querySelector(".profile__avatar"),w=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__name"),B=document.querySelector(".profile__vocation"),T=document.getElementById("error-textbox"),x="https://nomoreparties.co/v1/plus-cohort-22",D={profile:"".concat(x,"/users/me"),cards:"".concat(x,"/cards"),likes:"".concat(x,"/cards/likes"),avatar:"".concat(x,"/users/me/avatar")},F={authorization:"8d808c3f-b327-4ea6-8bf0-44d89d4dbe86","Content-Type":"application/json"},j={popupEditProfile:o,popupNewPost:r,popupEditAvatar:n,popupPost:i,popupDeleteSubmit:a,popupError:u},N={editProfileForm:c,newPostForm:l,editAvatarForm:s,deleteSubmitForm:d,errorForm:p},O={editProfileSubmitButton:v,newPostSubmitButton:b,editAvatarSubmitButton:y,deleteSubmitButton:h},V={newPostInputTitle:_,newPostInputLink:E,editProfileInputName:C,editProfileInputVocation:P,avatarInputLink:k},M=function(t){var e=document.querySelector(".popup_opened");"Escape"===t.key&&e&&U(e)},G=function(t){t.target===t.currentTarget&&U(t.currentTarget)};function H(t){t.classList.add("popup_opened"),t.classList.contains("popup_transition")||t.classList.add("popup_transition"),document.addEventListener("keydown",M)}function U(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",M)}function z(t){var e=t.name,o=t.about;A.textContent=e,B.textContent=o}function J(t){var e=t.avatar;L.style.backgroundImage="url(".concat(e,")")}function $(t,e){var o=t.querySelector(".photo-post__likes-count"),r=t.querySelector(".photo-post__like-button");o.textContent=e.length,e.includes(t.userId)?r.classList.add("photo-post__like-button_active"):r.classList.remove("photo-post__like-button_active")}function K(t){var e=document.getElementById(t._id);e.likes=t.likes.map((function(t){return t._id})),$(e,e.likes)}function Q(t,e){var o=t.name,r=t.link,n=t.owner,i=t.likes,a=t._id,u=I.querySelector(".photo-post").cloneNode(!0);u.id=a,u.userId=e,u.ownerId=n._id,u.likes=i.map((function(t){return t._id}));var c=u.querySelector(".photo-post__image");c.src=r,c.alt=o,c.addEventListener("click",st),u.querySelector(".photo-post__title").textContent=o,$(u,u.likes);var l=u.querySelector(".photo-post__delete-button");return u.ownerId===u.userId?l.addEventListener("click",dt):l.remove(),u}function R(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o)):(e.disabled=!0,e.classList.add(o))}function W(t,e){var o=e.inputErrorClass,r=e.errorClass;t.classList.remove(o);var n=document.getElementById("".concat(t.id,"-error"));n.classList.remove(r),n.textContent=""}function X(t,e){var o=e.inputSelector,r=e.submitButtonSelector,n=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(o));R(u,t.querySelector(r),n),u.forEach((function(t){W(t,{inputErrorClass:i,errorClass:a})}))}function Y(t,e,o){t?(localStorage.setItem("buttonText",e.textContent),e.textContent=o):(e.textContent=localStorage.getItem("buttonText"),localStorage.removeItem("buttonText"))}function Z(t){T.textContent=t,H(j.popupError)}function tt(t){t.statusCode?Z(t.message):Z("Connection trouble, check your network")}function et(t){return t.ok?t.json():t.json().then((function(e){return e.statusCode=t.status,Promise.reject(e)}))}function ot(t){var e=t.endpoint,o=t.data,r=t.method,n={headers:F,method:r};return o&&(n.method=r,n.body=JSON.stringify(o)),fetch(e,n)}S.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return U(e)})),e.addEventListener("click",G)}));var rt,nt={getProfileData:function(){return ot({endpoint:D.profile,method:"GET"}).then(et)},loadCards:function(){return ot({endpoint:D.cards,method:"GET"}).then(et)},editProfileInfo:function(t){return ot({endpoint:D.profile,data:t,method:"PATCH"}).then(et)},editProfileAvatar:function(t){return ot({endpoint:D.avatar,data:t,method:"PATCH"}).then(et)},addNewCard:function(t){return ot({endpoint:D.cards,data:t,method:"POST"}).then(et)},deleteCardData:function(t){return ot({endpoint:"".concat(D.cards,"/").concat(t),method:"DELETE"}).then(et)},toggleLike:function(t){var e=t.cardId,o=t.isLiked;return ot({endpoint:"".concat(D.likes,"/").concat(e),method:o?"DELETE":"PUT"}).then(et)}};function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}function at(t){var e;t.preventDefault(),e={name:V.editProfileInputName.value,about:V.editProfileInputVocation.value},Y(!0,O.editProfileSubmitButton,"Сохранение..."),nt.editProfileInfo(e).then(z).catch(tt).finally((function(){Y(!1,O.editProfileSubmitButton)})),U(j.popupEditProfile)}function ut(t){var e;t.preventDefault(),e={name:V.newPostInputTitle.value,link:V.newPostInputLink.value},Y(!0,O.newPostSubmitButton,"Сохранение..."),nt.addNewCard(e).then(ct).catch(tt).finally((function(){Y(!1,O.newPostSubmitButton)})),U(j.popupNewPost)}function ct(t){g.prepend(Q(t,rt))}function lt(t){var e;t.preventDefault(),e={avatar:V.avatarInputLink.value},Y(!0,O.editAvatarSubmitButton,"Сохранение..."),nt.editProfileAvatar(e).then(J).catch(tt).finally((function(){Y(!1,O.editAvatarSubmitButton)})),U(j.popupEditAvatar)}function st(t){var e,o,r;o=(e={title:t.target.alt,link:t.target.src}).title,r=e.link,m.alt=o,m.src=r,f.textContent=o,H(j.popupPost)}function dt(t){var e=t.target.closest(".photo-post").id;localStorage.setItem("cardIdToDelete",e),H(j.popupDeleteSubmit)}g.addEventListener("click",(function(t){var e;t.target.classList.contains("photo-post__like-button")&&(e=t.target.closest(".photo-post"),nt.toggleLike({cardId:e.id,isLiked:e.likes.includes(rt)}).then(K).catch(tt))})),Promise.all([nt.getProfileData(),nt.loadCards()]).then((function(t){var e,o,r=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var r,n,i,a,u=[],c=!0,l=!1;try{if(i=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;c=!1}else for(;!(c=(r=i.call(o)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){l=!0,n=t}finally{try{if(!c&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw n}}return u}}(e,o)||function(t,e){if(t){if("string"==typeof t)return it(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?it(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],i=r[1],a=n.name,u=n.about,c=n.avatar,l=n._id;rt=l,z({name:a,about:u}),J({avatar:c}),i.forEach((function(t){g.append(Q(t,rt))}))})).catch(tt),w.addEventListener("click",(function(){var t,o,r;N.editProfileForm.reset(),o=(t={name:A.textContent,about:B.textContent}).name,r=t.about,V.editProfileInputName.value=o,V.editProfileInputVocation.value=r,X(N.editProfileForm,e),H(j.popupEditProfile)})),q.addEventListener("click",(function(){N.newPostForm.reset(),X(N.newPostForm,e),H(j.popupNewPost)})),L.addEventListener("click",(function(){N.editAvatarForm.reset(),X(N.editAvatarForm,e),H(j.popupEditAvatar)})),N.editProfileForm.addEventListener("submit",at),N.newPostForm.addEventListener("submit",ut),N.editAvatarForm.addEventListener("submit",lt),N.deleteSubmitForm.addEventListener("submit",(function(t){var e;t.preventDefault(),e=localStorage.getItem("cardIdToDelete"),Y(!0,O.deleteSubmitButton,"Удаление..."),nt.deleteCardData(e).then((function(){document.getElementById(e).remove()})).catch(tt).finally((function(){Y(!1,O.deleteSubmitButton)})),localStorage.removeItem("cardIdToDelete"),U(j.popupDeleteSubmit)})),N.errorForm.addEventListener("submit",(function(t){t.preventDefault(),U(j.popupError)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=e.inputSelector,r=e.submitButtonSelector,n=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(o)),c=t.querySelector(r);R(u,c,n),u.forEach((function(t){t.addEventListener("input",(function(){(function(t,e){t.validity.patternMismatch?t.setCustomValidity(t.dataset.alphabetError):"url"===t.type&&t.validity.typeMismatch?t.setCustomValidity(t.dataset.urlError):t.setCustomValidity(""),t.validity.valid?W(t,e):function(t,e,o){var r=o.inputErrorClass,n=o.errorClass;t.classList.add(r);var i=document.getElementById("".concat(t.id,"-error"));i.classList.add(n),i.textContent=e}(t,t.validationMessage,e)})(t,{inputErrorClass:i,errorClass:a}),R(u,c,n)}))}))}(e,t)}))}(e)})();
//# sourceMappingURL=main.js.map