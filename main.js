(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{R0:()=>st,vM:()=>dt,ti:()=>pt});var e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},o=document.querySelector(".popup_edit-profile"),r=document.querySelector(".popup_new-post"),n=document.querySelector(".popup_update-avatar"),i=document.querySelector(".popup_post"),a=document.querySelector(".popup_delete-submit"),u=document.querySelector(".popup_error"),c=document.forms["edit-profile"],l=document.forms["new-post"],d=document.forms["update-avatar"],s=document.forms["delete-submit"],p=document.forms["error-view"],m=i.querySelector(".view-post__image"),f=i.querySelector(".view-post__caption"),v=c["submit-button"],y=l["submit-button"],b=d["submit-button"],h=s["submit-button"],S=document.querySelectorAll(".popup__close-button"),_=Array.from(d.querySelectorAll(".form__input")),E=Array.from(l.querySelectorAll(".form__input")),C=Array.from(c.querySelectorAll(".form__input")),g="avatar-input-",k="place-input-",P="profile-input-",L=document.querySelector(".photo-grid"),A=document.querySelector("#template-photo-post").content,q=document.querySelector(".profile__avatar"),w=document.querySelector(".profile__edit-button"),I=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__name"),x=document.querySelector(".profile__vocation"),T=document.getElementById("error-textbox"),D="https://nomoreparties.co/v1/plus-cohort-22",F={profile:"".concat(D,"/users/me"),cards:"".concat(D,"/cards"),likes:"".concat(D,"/cards/likes"),avatar:"".concat(D,"/users/me/avatar")},j={authorization:"8d808c3f-b327-4ea6-8bf0-44d89d4dbe86","Content-Type":"application/json"},O={popupEditProfile:o,popupNewPost:r,popupEditAvatar:n,popupPost:i,popupDeleteSubmit:a,popupError:u},N={editProfileForm:c,newPostForm:l,editAvatarForm:d,deleteSubmitForm:s,errorForm:p},M={editProfileSubmitButton:v,newPostSubmitButton:y,editAvatarSubmitButton:b,deleteSubmitButton:h},V=function(t){"Escape"===t.key&&U(document.querySelector(".popup_opened"))},G=function(t){t.target===t.currentTarget&&U(t.currentTarget)};function H(t){t.classList.add("popup_opened"),t.classList.contains("popup_transition")||t.classList.add("popup_transition"),document.addEventListener("keydown",V)}function U(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",V)}function z(t){var e=t.name,o=t.about;B.textContent=e,x.textContent=o}function J(t){var e=t.avatar;q.style.backgroundImage="url(".concat(e,")")}function R(t,e){var o=t.name,r=t.link,n=t.owner,i=t.likes,a=t._id,u=A.querySelector(".photo-post").cloneNode(!0);u.id=a,u.userId=e,u.ownerId=n._id,u.likes=i.map((function(t){return t._id}));var c=u.querySelector(".photo-post__image");c.src=r,c.alt=o,c.addEventListener("click",dt),u.querySelector(".photo-post__title").textContent=o;var l=u.querySelector(".photo-post__like-button"),d=u.querySelector(".photo-post__likes-count");function s(){d.textContent=u.likes.length,u.likes.includes(u.userId)?l.classList.add("photo-post__like-button_active"):l.classList.remove("photo-post__like-button_active")}function p(t){u.likes=t.likes.map((function(t){return t._id})),s()}l.addEventListener("click",(function(){st(u,p)})),s();var m=u.querySelector(".photo-post__delete-button");return u.ownerId===u.userId?m.addEventListener("click",pt):m.remove(),u}function $(t,e){t.disabled=!0,t.classList.add(e)}function K(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t,e){t.disabled=!1,t.classList.remove(e)}(e,o):$(e,o)}function Q(t,e){var o=e.inputErrorClass,r=e.errorClass;t.classList.remove(o);var n=document.getElementById("".concat(t.id,"-error"));n.classList.remove(r),n.textContent=""}function W(t,e){var o=e.inputSelector,r=e.submitButtonSelector,n=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(o));$(t.querySelector(r),n),u.forEach((function(t){Q(t,{inputErrorClass:i,errorClass:a})}))}function X(t,e,o){t?(localStorage.setItem("buttonText",e.textContent),e.textContent=o):(e.textContent=localStorage.getItem("buttonText"),localStorage.removeItem("buttonText"))}function Y(t){T.textContent=t,H(O.popupError)}function Z(t){console.dir(t),t.statusCode?Y(t.message):Y("Connection trouble, check your network")}function tt(t,e){var o=e.length;return t.reduce((function(t,e){return t[e.id.slice(o)]=e.value,t}),{})}function et(t){return t.ok?t.json():t.json().then((function(e){return e.statusCode=t.status,Promise.reject(e)}))}function ot(t){var e=t.endpoint,o=t.data,r=t.method,n={headers:j,method:r};return o&&(n.method=r,n.body=JSON.stringify(o)),fetch(e,n)}S.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return U(e)})),e.addEventListener("click",G)}));var rt,nt={getProfileData:function(){return ot({endpoint:F.profile,method:"GET"}).then(et)},loadCards:function(){return ot({endpoint:F.cards,method:"GET"}).then(et)},editProfileInfo:function(t){return ot({endpoint:F.profile,data:t,method:"PATCH"}).then(et)},editProfileAvatar:function(t){return ot({endpoint:F.avatar,data:t,method:"PATCH"}).then(et)},addNewCard:function(t){return ot({endpoint:F.cards,data:t,method:"POST"}).then(et)},deleteCardData:function(t){return ot({endpoint:"".concat(F.cards,"/").concat(t),method:"DELETE"}).then(et)},toggleLike:function(t){var e=t.cardId,o=t.isLiked;return ot({endpoint:"".concat(F.likes,"/").concat(e),method:o?"DELETE":"PUT"}).then(et)}};function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}function at(t){var e;t.preventDefault(),e=tt(C,P),X(!0,M.editProfileSubmitButton,"Сохранение..."),nt.editProfileInfo(e).then(z).catch(Z).finally((function(){X(!1,M.editProfileSubmitButton)})),U(O.popupEditProfile)}function ut(t){var e;t.preventDefault(),e=tt(E,k),X(!0,M.newPostSubmitButton,"Сохранение..."),nt.addNewCard(e).then(ct).catch(Z).finally((function(){X(!1,M.newPostSubmitButton)})),U(O.popupNewPost)}function ct(t){L.prepend(R(t,rt))}function lt(t){var e;t.preventDefault(),e=tt(_,g),X(!0,M.editAvatarSubmitButton,"Сохранение..."),nt.editProfileAvatar(e).then(J).catch(Z).finally((function(){X(!1,M.editAvatarSubmitButton)})),U(O.popupEditAvatar)}function dt(t){var e,o,r;o=(e={title:t.target.alt,link:t.target.src}).title,r=e.link,m.alt=o,m.src=r,f.textContent=o,H(O.popupPost)}function st(t,e){nt.toggleLike({cardId:t.id,isLiked:t.likes.includes(rt)}).then(e).catch(Z)}function pt(t){var e=t.target.closest(".photo-post").id;localStorage.setItem("cardIdToDelete",e),H(O.popupDeleteSubmit)}Promise.all([nt.getProfileData(),nt.loadCards()]).then((function(t){var e,o,r=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var r,n,i,a,u=[],c=!0,l=!1;try{if(i=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;c=!1}else for(;!(c=(r=i.call(o)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){l=!0,n=t}finally{try{if(!c&&null!=o.return&&(a=o.return(),Object(a)!==a))return}finally{if(l)throw n}}return u}}(e,o)||function(t,e){if(t){if("string"==typeof t)return it(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?it(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=r[0],i=r[1],a=n.name,u=n.about,c=n.avatar,l=n._id;rt=l,z({name:a,about:u}),J({avatar:c}),i.forEach((function(t){L.append(R(t,rt))}))})).catch(Z),w.addEventListener("click",(function(){var t,o,r,n;N.editProfileForm.reset(),t=C,o=P,r={name:B.textContent,about:x.textContent},n=o.length,t.forEach((function(t){t.value=r[t.id.slice(n)]})),W(N.editProfileForm,e),H(O.popupEditProfile)})),I.addEventListener("click",(function(){N.newPostForm.reset(),W(N.newPostForm,e),H(O.popupNewPost)})),q.addEventListener("click",(function(){N.editAvatarForm.reset(),W(N.editAvatarForm,e),H(O.popupEditAvatar)})),N.editProfileForm.addEventListener("submit",at),N.newPostForm.addEventListener("submit",ut),N.editAvatarForm.addEventListener("submit",lt),N.deleteSubmitForm.addEventListener("submit",(function(t){var e;t.preventDefault(),e=localStorage.getItem("cardIdToDelete"),X(!0,M.deleteSubmitButton,"Удаление..."),nt.deleteCardData(e).then((function(){document.getElementById(e).remove()})).catch(Z).finally((function(){X(!1,M.deleteSubmitButton)})),localStorage.removeItem("cardIdToDelete"),U(O.popupDeleteSubmit)})),N.errorForm.addEventListener("submit",(function(t){t.preventDefault(),U(O.popupError)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=e.inputSelector,r=e.submitButtonSelector,n=e.inactiveButtonClass,i=e.inputErrorClass,a=e.errorClass,u=Array.from(t.querySelectorAll(o)),c=t.querySelector(r);K(u,c,n),u.forEach((function(t){t.addEventListener("input",(function(){(function(t,e){t.validity.patternMismatch?t.setCustomValidity(t.dataset.alphabetError):"url"===t.type&&t.validity.typeMismatch?t.setCustomValidity(t.dataset.urlError):t.setCustomValidity(""),t.validity.valid?Q(t,e):function(t,e,o){var r=o.inputErrorClass,n=o.errorClass;t.classList.add(r);var i=document.getElementById("".concat(t.id,"-error"));i.classList.add(n),i.textContent=e}(t,t.validationMessage,e)})(t,{inputErrorClass:i,errorClass:a}),K(u,c,n)}))}))}(e,t)}))}(e)})();
//# sourceMappingURL=main.js.map